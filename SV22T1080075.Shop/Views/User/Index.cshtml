@{
    ViewData["Title"] = "Thông tin tài khoản";
}

<section class="py-5">
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-12">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mt-5">
                        <li class="breadcrumb-item"><a href="/" class="text-decoration-none text-dark">Trang chủ</a></li>
                        <li class="breadcrumb-item active text-primary" aria-current="page">Tài khoản của tôi</li>
                    </ol>
                </nav>
            </div>
        </div>

        <div class="row g-5 mt-2">
            <div class="col-lg-3">
                <div class="card border-0 shadow-sm rounded-4 p-4">

                    <div class="text-center mb-4">
                        <div class="position-relative d-inline-block">
                            @* Ảnh hiển thị chính - Thêm ID để JavaScript thay đổi src *@
                            <img id="avatarPreview" src="~/images/reviewer-1.jpg" alt="avatar"
                                 class="img-fluid rounded-circle mb-3 shadow-sm"
                                 style="width: 120px; height: 120px; object-fit: cover; border: 4px solid #fff;">

                            @* Nút chọn file ẩn dưới dạng biểu tượng camera *@
                            <label for="avatarUpload"
                                   class="position-absolute bottom-0 end-0 bg-primary text-white d-flex align-items-center justify-content-center rounded-circle shadow-sm"
                                   style="cursor: pointer; transform: translate(-10%, -20%); width: 40px; height: 40px;">

                                <svg width="20" height="20"><use xlink:href="#camera"></use></svg>
                                <input type="file" id="avatarUpload" name="avatarFile" accept="image/*" class="d-none">
                            </label>

                        </div>
                        <h5 class="mt-2 mb-0">Nguyễn Văn A</h5>
                        <p class="text-muted small">Cập nhật ảnh đại diện của bạn</p>
                    </div>

                    <div class="list-group list-group-flush account-menu" id="account-tabs" role="tablist">
                        @* Tab Hồ sơ cá nhân *@
                        <a class="list-group-item list-group-item-action border-0 active rounded-3 mb-1 py-3"
                           id="tab-profile-link" data-bs-toggle="list" href="#tab-profile" role="tab">
                            <svg width="20" height="20" class="me-2"><use xlink:href="#user"></use></svg> Hồ sơ cá nhân
                        </a>

                        @* Tab Đơn hàng *@
                        <a class="list-group-item list-group-item-action border-0 rounded-3 mb-1 py-3"
                           id="tab-orders-link" data-bs-toggle="list" href="#tab-orders" role="tab">
                            <svg width="20" height="20" class="me-2"><use xlink:href="#cart"></use></svg> Đơn hàng của tôi
                        </a>
                        <a href="#" class="list-group-item list-group-item-action border-0 rounded-3 mb-1 py-3">
                            <svg width="20" height="20" class="me-2"><use xlink:href="#heart"></use></svg> Danh sách yêu thích
                        </a>
                        <a href="#" class="list-group-item list-group-item-action border-0 rounded-3 mb-1 py-3">
                            <svg width="20" height="20" class="me-2"><use xlink:href="#location"></use></svg> Thay đổi mật khẩu
                        </a>
                        <hr>
                        <a href="#" class="list-group-item list-group-item-action border-0 rounded-3 py-3 text-danger">
                            <svg width="20" height="20" class="me-2"><use xlink:href="#close"></use></svg> Đăng xuất
                        </a>
                    </div>
                </div>
            </div>

            <div class="col-lg-9">
                <div class="tab-content" id="account-tabs-content">

                    @* TAB 1: HỒ SƠ CÁ NHÂN *@
                    <div class="tab-pane fade show active" id="tab-profile" role="tabpanel" aria-labelledby="tab-profile-link">
                        @await Html.PartialAsync("~/Views/User/Profile.cshtml")
                    </div>

                    @* TAB 2: ĐƠN HÀNG CỦA TÔI *@
                    <div class="tab-pane fade" id="tab-orders" role="tabpanel" aria-labelledby="tab-orders-link">
                        @await Html.PartialAsync("~/Views/User/Orders.cshtml")
                    </div>

                </div> @* Kết thúc tab-content *@
            </div>

        </div>
    </div>
</section>

<style>
    .account-menu .list-group-item.active {
        background-color: var(--primary-color);
        color: white;
    }

    .account-menu .list-group-item:hover:not(.active) {
        background-color: #f8f9fa;
        color: var(--primary-color);
    }
</style>

@section Scripts {
    <script>
        $(document).ready(function () {
            // 1. Xử lý xem trước Avatar (Đã có trong code của bạn)
            $('#avatarUpload').change(function (e) {
                var file = e.target.files[0];
                if (file) {
                    var reader = new FileReader();
                    reader.onload = function (event) {
                        $('#avatarPreview').attr('src', event.target.result);
                    };
                    reader.readAsDataURL(file);
                }
            });

            // 2. Xử lý chuyển đổi Tab mượt mà
            $('#account-tabs a').on('click', function (e) {
                e.preventDefault();
                // Hiển thị tab tương ứng
                $(this).tab('show');

                // Cập nhật URL hash để khi F5 vẫn ở tab đó (tùy chọn)
                window.location.hash = $(this).attr('href');
            });

            // 3. Tự động mở tab dựa trên URL hash khi tải lại trang
            var hash = window.location.hash;
            if (hash) {
                $('#account-tabs a[href="' + hash + '"]').tab('show');
            }
        });
    </script>
}